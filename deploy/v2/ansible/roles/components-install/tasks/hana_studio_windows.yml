---

- name: Create dictionary with installation variant for HANA Studio 
  set_fact:
    studio: "{{ item }}"
  loop: "{{ components }}"
  when: item.component == 'hana_studio'

- name: Download Visual C++ package
  win_get_url:
    url: https://download.microsoft.com/download/2/E/6/2E61CFA4-993B-4DD4-91DA-3737CD5CD6E3/vcredist_x64.exe
    dest: C:\Users\{{ ansible_user }}\install
  loop: "{{ studio.variants|flatten(levels=1) }}"
  when: item.os == 'WINDOWS'

- name: Install Visual C++ package
  win_command: C:\Users\{{ ansible_user }}\install\vcredist_x64.exe /install /quiet
  loop: "{{ studio.variants|flatten(levels=1) }}"
  when: item.os == 'WINDOWS'

- name: Copy to Hana Studio Installer
  win_copy: 
    src: "{{ hana_software_loc }}/{{ item.media_loc }}"
    dest: C:\Users\{{ ansible_user }}\install
  loop: "{{ studio.variants|flatten(levels=1) }}"
  when: item.os == 'WINDOWS'

- name: Install Hana Studio
  win_shell: C:\Users\{{ ansible_user }}\install\{{ item.media_loc }}\{{ item.installer }} -a studio -b --path=C:\Users\{{ ansible_user }}\SAP_HANA_STUDIO
  args: 
    creates: C:\Users\{{ ansible_user }}\SAP_HANA_CLIENT
  loop: "{{ studio.variants|flatten(levels=1) }}"
  when: item.os == 'WINDOWS'
